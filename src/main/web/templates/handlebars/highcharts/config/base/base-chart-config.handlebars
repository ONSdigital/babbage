{{!--
This template forms a base configuration for all chart types, this is included in client side as javascript source file. 
It is used to render highchart configuration and attach it to window object when run in a browser. Since Highcharts configurations are javascript objects it is not possible to read complex chart configurations ( objects with functions as members) as json objects, that is why it has to be rendered dynamically as a javascript source file.
The chart configurations are used both by Babbage and Florence, thats why it is rendered on server side using handlebars to make it possible to edit configuration without the need of rebuilding.
--}}

(function(){

	Highcharts.setOptions({lang: {thousandsSep: ','}});

	{{!-- chart-config block is to be overriden by chart types inheriting this template --}}
	var options = {
		chart: {
			height: {{width}} * {{aspectRatio}},
			width: {{width}},
			marginRight: 35,
			style: {
				fontFamily: 'Tahoma, Verdana, Arial'
			}
		},
		colors: [
			"#274796",
			"#F5942F",
			"#E73F40",
			"#7BCAE2",
			"#979796",
			"#E9E117",
			"#74B630",
			"#674796",
			"#BD5B9E"
		],
		series: [],
		title: {
			text: ""
		},
		yAxis: {
			title: {
				text: "",
				useHTML:true
			},
			labels: {
				format: "{value:,f}",
				useHTML:true
			},
			plotLines: [{color: 'gray',width: 2,value: 0,zIndex: -100}],
			gridZIndex: -200
		},
		xAxis: {
			categories: [{{#each categories}}'{{{sub (sup this)}}}',{{/each}}],
			tickInterval: "{{labelInterval}}",
			labels: {
				useHTML : true,
			},
			title: {
				useHTML:true,
				text: "{{{sub (sup xAxisLabel)}}}"
			}
		},
		legend: {
			verticalAlign: "top",
			useHTML:true,
			enabled:{{#if_eq series.size 1}}false{{else}}true{{/if_eq}}
		},
		plotOptions: {
			series: {
				animation: false,
				pointPadding: 0,
				groupPadding: 0.1
			},
			line: {
				lineWidth: 1,
				marker: {
					radius: 2,
					symbol: "circle"
				}
			},
			area: {
				stacking: "normal"
			}
		},

		tooltip: {
			valueDecimals: "{{decimalPlaces}}",
			shared: true,
			useHTML:true,
            style: {
                padding: 0
            },
            formatter: function() {
                var div = '<div id="custom-tooltip"><div class="maintext">';
                var s = '<b>'+ this.x +'</b>';

                $.each(this.points, function(i, point) {
                    s += '<br/><span style="color:'+ point.series.color +'">\u25CF</span> ' + point.series.name + ': ' + point.y{{#if decimalPlaces}}.toFixed({{decimalPlaces}}){{/if}};
                });

                div += s + '</div></div>';

                return div;
            },
            backgroundColor: 'rgba(208,210,211, 1)',
            borderWidth: 0,
            borderRadius: 0,
            borderColor: 'rgba(255, 255, 255, 0)',
            shadow: false
		},
		credits: {
			enabled: false
		},
		labels: {
			useHTML:true
		}
	};

	var unit = "{{{sub (sup unit)}}}";

	options.yAxis.title.text=unit;
	options.yAxis.title.align="high";
	{{#unless rotated}}
    options.yAxis.title.offset=0;

    {{#if options.legend.enabled}}options.yAxis.title.y=-2;{{/if}}
    {{!-- Setting rotation to 0 causes axis lable push chart to the right for some text (e.g. "GDP growth percentage" ) and shrinks it in size. Funny enough, rotating 360 degrees eliminates this issue and still keeps the label horizontal.  --}}
	options.yAxis.title.rotation=360;
	options.yAxis.title.style={
		left:"0px",
		right:"0px"
	};

	{{/unless}}

	{{#block "chart-config"}}
	{{!-- Overridde this block for altering chart configuration for individual chart types --}}
	{{/block}}

	{{!-- Chart id is the file name for Florence chart builder generated charts, and cdid for time series --}}
	var chartId = "{{#if filename}}{{filename}}{{else}}{{description.cdid}}{{/if}}";

	{{!-- attaching id to window object to be used on client side --}}
	window["chart-" + chartId] = options;

	{{!-- Returning chart to be used by highcharts export server for server side image rendering --}}
	return options;

{{!-- Don't add semi-colon at end of closing brackets below - it breaks server-side rendering --}}
})()